地锁控制逻辑

1.设备上电之后判断地锁状态，如果地锁处于开启或关闭状态保持当前状态；处于中间状态则下降电机，下降电机到达关闭状态后向充电桩上报地锁当前状态，不检测车辆状态计时15秒，15秒后控制电机升起地锁；处于过转状态，不检测车辆状态直接控制电机升起至关闭状态。
2.设备运行中时刻监测当前地锁状态，根据不同状态相应执行相应的动作
(1)地锁处于关闭状态：
①如果是收到下降指令后顺利执行到此状态，蜂鸣器鸣笛一声，并开始3-4分钟停车计时，如果规定时间内没有检测到车辆，控制电机升起地锁。
②如果未收到指令从中间状态执行至此状态（外力作用），不检测车辆状态直接控制电机升起地锁。
③如果上一时刻不是关闭状态，向充电桩上报此状态。
④如果在关闭状态下收到下降指令，向充电桩上报此状态。
⑤如果在关闭状态下收到上升指令，蜂鸣器鸣笛一声，检测此时地锁上方是否有车辆，如果没有车辆，控制电机升起，否则停止电机。
⑥如果关闭状态下，未收到指令，15秒内持续检测不到车辆（车辆驶离）控制电机升起地锁；若15秒内检测到车辆，重新计时。
(2)地锁处于开启状态
①如果是收到上升指令后顺利执行到此状态，蜂鸣器鸣笛一声。
②如果上一时刻不是开启状态，向充电桩上报此状态。
③如果在开启状态收到下降指令，蜂鸣器鸣笛一声，控制电机下降地锁。
④如果在开启状态收到上升指令，向充电桩上报此状态。
(3)地锁处于上升或下降的中间状态
①如果未收到指令处于此状态，不检测车辆状态，直接控制电机升起地锁。
②如果是收到下降指令从开启状态执行至此状态，控制电机下降地锁，若15秒内未成功下降至关闭状态（外力阻转），控制电机上升地锁。
③如果是收到上升指令从关闭状态执行至此状态，检测地锁上方车辆状态，如果检测到车辆，停止电机，如果持续2秒监测到车辆，控制电机下降地锁，否则继续控制电机上升地锁。若15秒内未上升至开启状态（外力阻转），控制电机下降地锁。
④如果下降遇到阻转控制电机上升时，检测地锁上方是否有车辆，如果检测到车辆停止电机，如果持续2秒监测到车辆，控制电机下降地锁，否则继续控制电机升起地锁。
⑤如果下降遇到阻转控制电机上升时，15秒内未下降至关闭状态，控制电机上升地锁。
⑥如果因上升遇到阻转或检测到车辆而下降时，若15秒内未下降至关闭状态，控制电机升起地锁，进入下降遇到阻转升起地锁。
⑦其他异常状态（未收到指令）（外力影响）直接控制电机升起地锁。
(4)如果处于过转状态
①不检测车辆状态，直接控制电机升起地锁至开启状态。
3.如果地锁处于开启或者关闭状态，每10分钟向充电桩上报一次当前地锁状态。
4.地锁丝印3.3V和SCLK之间若有跳线帽连接则为B枪（地址0X02）,没有跳线帽连接为A枪（地址0X01）。485通信设置为波特率9600，偶校验，1位停止位。